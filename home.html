<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>

    <script src="resources/jquery-3.2.1.min.js"></script>
</head>
<body>
    <h3>Client side IP geolocation using <a href="http://ipinfo.io">ipinfo.io</a></h3>

    <hr/>
    <div id="ip"></div>
    <div id="address"></div>
    <hr/>Full response: <pre id="details"></pre>
    <hr/>
    <button id="bottone">CLICCA!</button>
    <div id="geolocal"></div>

    <script>
    $.get("http://ipinfo.io", function (response) {
            $("#ip").html("IP: " + response.ip);
            $("#address").html("Location: " + response.city + ", " + response.region);
            $("#details").html(JSON.stringify(response, null, 4));
        }, "jsonp");

    function initMap() {
        var geocoder = new google.maps.Geocoder;
        var latlng = {lat: 41.9000, lng: 12.4833};

        document.getElementById('bottone').addEventListener('click', function() {
            boh(geocoder, latlng);
        });
    }

    function boh(geocoder, latlng) {
        geocoder.geocode({'location': latlng}, function(results, status) {
            if (status === 'OK') {
                if (results[0]) {
                    console.log(results[0].formatted_address);
                    var types = ["country", "political"];
                    for (var i=0; i<results[0].address_components.length; i++) {
                        var tipi = results[0].address_components[i].types;
                        console.log(tipi);
                        var is_same = tipi.length === types.length && tipi.every(function(element, index) {
                            return element === types[index];
                        });
                        if (is_same) {
                            var stato = results[0].address_components[i].long_name;
                            break;
                        }
                    }
                    //console.log(results[0]);
                    //console.log("Stato: " + stato);
                    $("#geolocal").text("Stato: " + stato);
                } else {
                    window.alert('No results found');
                }
            } else {
                window.alert('Geocoder failed due to: ' + status);
            }
        });
    }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpuShiDSi1Hq1WKc-O9FMXRp_2eivSLgg&callback=initMap">
    </script>
</body>
</html>